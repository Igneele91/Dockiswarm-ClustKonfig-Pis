
## 7. DuckDNS 

# 7.3 Fragen und Antworten zu DuckDNS
# 7.3.1 Erstellung eines Cronjobs auf einem Raspberry Pi
# Zur Erstellung eines Cronjobs auf einem Raspberry Pi kÃ¶nnen Sie die folgenden Schritte befolgen:
# 1. Ã–ffnen Sie ein Terminal auf Ihrem Raspberry Pi.
# 2. Geben Sie Â«crontab -eÂ» ein und drÃ¼cken Sie die Eingabetaste. Dies Ã¶ffnet den Crontab-Editor. 
# Wenn Sie das erste Mal den Crontab-Editor verwenden, wird er Sie wahrscheinlich fragen, 
# welchen Editor Sie verwenden mÃ¶chten. Nano ist eine einfache Option und wird oft als Standard festgelegt.
# 3. Sie sehen nun den Crontab-Editor. Um einen neuen Cronjob hinzuzufÃ¼gen, fÃ¼gen Sie eine neue 
# Zeile am Ende der Datei hinzu. Zum Beispiel kÃ¶nnten Sie den folgenden Eintrag hinzufÃ¼gen, 
# um das Duck DNS-Skript alle fÃ¼nf Minuten auszufÃ¼hren:



*/5 * * * * /home/pi/duckdns/duck.sh >/dev/null 2>&1



# 7.3.3 Wie integriere ich Duck DNS in mein Cluster?
# Es gibt mehrere Wege, Duck DNS in Ihr Cluster zu nutzen:
# 1. Als Konfigurationsdatei: Sie kÃ¶nnen eine Shell-Skriptdatei Â«duck.shÂ» erstellen, die
# regelmÃ¤ssig (alle 5 Minuten) ausgefÃ¼hrt wird, um Ihre Ã¶ffentliche IP-Adresse an Duck
# DNS zu melden. Diese Konfigurationsdatei kann auf jedem Knoten Ihres Clusters 
# ausgefÃ¼hrt werden, der eine Verbindung zum Internet hat.
# Beispiel fÃ¼r eine Â«duck.shÂ» Datei:


#!/bin/bash
echo url="https://www.duckdns.org/update?domains=exampledomain&token=
a7c4d0ad-114e-40ef-ba1d-d217904a50f2&ip=" | curl -k
-o ~/duckdns/duck.log -K -




# Ersetzen Sie Â«exampledomainÂ» durch Ihre spezifische DuckDNS-Subdomain (wie
# Â«router-quinisiminiÂ», Â«portainer-quinisiminiÂ», Â«nginxproxy-quinisiminiÂ») und
# Â«tokenÂ» durch Ihren persÃ¶nlichen Token, den Sie von DuckDNS erhalten haben.
# Sie kÃ¶nnten dann einen Cron-Job erstellen, um dieses Skript alle fÃ¼nf Minuten
# auszufÃ¼hren. Zum Beispiel:

*/5 * * * * ~/duckdns/duck.sh >/dev/null 2>&1



# 2. Als Service: Sie kÃ¶nnten ein Docker-Image verwenden, z.B. Â«linuxserver/duckdnsÂ»,
# das einen Duck DNS-Client enthÃ¤lt. Sie kÃ¶nnen diesen als Service in Ihrem Cluster
# ausfÃ¼hren, der alle 5 Minuten Ihre IP-Adresse aktualisiert. Dies ist eine praktikable
# Methode, wenn Ihr Cluster Docker unterstÃ¼tzt.
# Hier ist ein Beispiel, wie Sie den Docker-Container erstellen kÃ¶nnten:

docker run -d --name=duckdns -e TZ=Europe/London -e
SUBDOMAINS=subdomain1,subdomain2 -e TOKEN=token -v
/path/to/appdata/config:/config â€“restart
unless-stopped linuxserver/duckdns




# Ersetzen Sie die Â«SUBDOMAINSÂ» und Â«TOKENÂ» durch Ihre spezifischen Werte (wie
# Â«router-quinisiminiÂ», Â«portainer-quinisiminiÂ», Â«nginxproxy-quinisiminiÂ») und Ã¤ndern
# Sie den Pfad zu Ihrer Konfigurationsdatei.

# 3. Als Stack: Wenn Ihr Cluster Docker Swarm unterstÃ¼tzt, kÃ¶nnen Sie Duck DNS auch
# als Stack ausfÃ¼hren. In dieser Konfiguration wird Duck DNS als Docker Service innerhalb
# eines Docker Stacks ausgefÃ¼hrt, der Ihre Ã¶ffentliche IP-Adresse aktualisiert.
# Ein Beispiel fÃ¼r einen Docker Swarm Stack, der den Duck DNS Service beinhaltet, kÃ¶nnte
# folgendermassen aussehen:


  version: '3.3'
  services:
    duckdns:
      image: linuxserver/duckdns
      environment:
        - TZ=Europe/Berlin
        - SUBDOMAINS=subdomain
        - TOKEN=your-token
      deploy:
        mode: global
        restart_policy:
          condition: on-failure
        placement:
          constraints:
            - node.role == manager




## Nachdem Sie diese Konfiguration in einer Datei namens Â«duckdns.ymlÂ» gespeichert
## haben, kÃ¶nnen Sie den Duck DNS-Service mit dem folgenden Befehl starten:

docker stack deploy -c duckdns.yml duckdns


## Vergessen Sie nicht, Ihre CNAME-EintrÃ¤ge bei Cloudflare entsprechend einzurichten, um
## auf die DuckDNS-Adressen zu zeigen:

  router-quinisimini.com.     CNAME  router-quinisimini.duckdns.org.
  portainer-quinisimini.com.  CNAME  portainer-quinisimini.duckdns.org.
  nginxproxy-quinisimini.com. CNAME  nginxproxy-quinisimini.duckdns.org. 


############################################# 
############################################# 
############################################# 



############ Duck DNS im CLuster ############


version: '3.3'
services:
  duckdns:
    image: linuxserver/duckdns
    environment:
      - TZ=Europe/Berlin
      - SUBDOMAINS=router-quinisimini,portainer-quinisimini,nginxproxy-quinisimini
      - TOKEN= ----------- einfÃ¼gen ------------
    deploy:
      mode: global
      restart_policy:
        condition: on-failure
      placement:
        constraints:
          - node.role == manager



## Ich hoffe alle haben verstanden wie ich subdomains bei duckdns zusÃ¤tzlich erstellt habe.
## Einfach das gleich rein wie von Cloudflare !! 


############################################# 
############################################# 
############################################# 



## Verbesserung V3 

Das es im selben netzwerk ist verbesserung mir Duck DNS: 



version: '3.3'
services:
  duckdns:
    image: linuxserver/duckdns
    networks:
      - mynetwork
    environment:
      - TZ=Europe/Berlin
      - SUBDOMAINS=router-quinisimini,portainer-quinisimini,nginxproxy-quinisimini
      - TOKEN=5e214ed4-8cce-492b-8838-2d838be00c84
    deploy:
      mode: replicated
      replicas: 1
      restart_policy:
        condition: on-failure
      placement:
        constraints:
          - node.role == manager

networks:
  mynetwork:




############################################# 
############################################# 
############################################# 



Ihr DuckDNS-Stack ist so konfiguriert, dass er im gleichen Netzwerk ("mynetwork") ausgefÃ¼hrt wird, wie die anderen 
Services (Nginx Proxy Manager und Portainer), die wir bisher betrachtet haben. 
Das ist sehr gut, da es die Kommunikation und Interaktion zwischen den Services erleichtert.

Es sieht so aus, als ob Ihr DuckDNS-Stack richtig konfiguriert ist. 
Er hat Umgebungsvariablen fÃ¼r die Zeitzone, Subdomains und Token, was typisch fÃ¼r einen DuckDNS-Service ist. 
AuÃŸerdem hat er eine Deploy-Konfiguration, die sicherstellt, dass der Service nach einem Fehler automatisch 
neu gestartet wird und dass er auf einem Manager-Knoten lÃ¤uft.



### Diesen Duck DNS Stack verwende ich in meinem CLuster

Hier ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘ğŸ‘


Hier ist Ihr Stack mit minimalen Ã„nderungen:



version: '3.3'
services:
  duckdns:
    image: linuxserver/duckdns
    networks:
      - mynetwork
    environment:
      - TZ=Europe/Berlin
      - SUBDOMAINS=router-quinisimini,portainer-quinisimini,nginxproxy-quinisimini
      - TOKEN=5e214ed4-8cce-492b-8838-2d838be00c84
    deploy:
      mode: replicated
      replicas: 1
      restart_policy:
        condition: on-failure
      placement:
        constraints:
          - node.role == manager

networks:
  mynetwork:
    external: true



Der einzige Unterschied ist, dass ich "external: true" zu "mynetwork" hinzugefÃ¼gt habe, 
da ich davon ausgehe, dass dieses Netzwerk bereits vor dem AusfÃ¼hren dieses Stacks erstellt wurde.














